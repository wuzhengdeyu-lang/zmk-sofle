# 版权信息与基础设置
# Copyright (c) 2022 Darryl deHaan
# SPDX-License-Identifier: MIT

# ==========================================
# 核心电源管理策略
# ==========================================
CONFIG_ZMK_SLEEP=y
# 30分钟后进入闲置状态 (1,800,000 ms)
CONFIG_ZMK_IDLE_TIMEOUT=1800000
# 2小时后进入深度睡眠 (7,200,000 ms)
CONFIG_ZMK_IDLE_SLEEP_TIMEOUT=7200000

# 唤醒优化：禁用 Soft Off 以防死锁
CONFIG_ZMK_PM_SOFT_OFF=n

# ==========================================
# 蓝牙稳定性与性能优化 (修复定格问题的核心)
# ==========================================
# 切换为内部 RC 振荡器。这是解决“随机假死”最有效的方法。
# 删除了报错的校准间隔参数，直接使用系统默认校准配置。
CONFIG_CLOCK_CONTROL_NRF_K32SRC_RC=y

# 优化蓝牙连接参数，强制要求更快的响应，防止链路阻塞
CONFIG_BT_PERIPHERAL_PREF_MIN_INT=6
CONFIG_BT_PERIPHERAL_PREF_MAX_INT=12
CONFIG_BT_BUF_ACL_TX_COUNT=10
CONFIG_BT_L2CAP_TX_BUF_COUNT=10

# 蓝牙发射功率：+5dBm 是兼顾稳定与抗干扰的推荐值
CONFIG_BT_CTLR_TX_PWR_PLUS_5=y

# ==========================================
# 灯光与电源输出设置
# ==========================================
CONFIG_ZMK_RGB_UNDERGLOW=n
CONFIG_WS2812_STRIP=n
CONFIG_ZMK_RGB_UNDERGLOW_EXT_POWER=n
CONFIG_ZMK_RGB_UNDERGLOW_AUTO_OFF_IDLE=n

CONFIG_ZMK_BACKLIGHT=n
CONFIG_ZMK_BACKLIGHT_ON_START=n
CONFIG_ZMK_BACKLIGHT_AUTO_OFF_IDLE=n

# 禁用全局外部电源输出（如果你的键盘有屏幕如 nice_view，这里设为 y 以免屏幕断电）
# 但由于你之前遇到定格问题，建议先设为 y 保证外设逻辑电平稳定
CONFIG_ZMK_EXT_POWER=y

# ==========================================
# 键盘输入性能
# ==========================================
CONFIG_ZMK_KSCAN_DEBOUNCE_PRESS_MS=8
CONFIG_ZMK_KSCAN_DEBOUNCE_RELEASE_MS=8

# 全键无冲：保持禁用以提高连接稳定性
CONFIG_ZMK_HID_REPORT_TYPE_NKRO=n

# 鼠标与滚轮支持
CONFIG_ZMK_POINTING=y
CONFIG_EC11=y
CONFIG_EC11_TRIGGER_GLOBAL_THREAD=y
